<!DOCTYPE html>
<html>

<head>
    <title>Students</title>
    <!-- <link href="https://kendo.cdn.telerik.com/themes/7.2.0/default/default-main.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <script src="js/kendo.all.min.js"></script> -->

    <link href="css/studentCoursesStyle.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-6">
                <h1></h1>
            </div>

            <div class="col-2">
                <a href="students.html" class="badge badge-primary">Students</a>
            </div>
        </div>




        <!-- <div class="row">
            <form class="form-inline">
                <label class="sr-only" for="firstName">firstName</label>
                <input type="text" class="form-control mb-2 mr-sm-2" name="firstName" id="firstName"
                    placeholder="first Name">

                <label class="sr-only" for="lastName">lastName</label>
                <input type="text" class="form-control mb-2 mr-sm-2" name="lastName" id="lastName"
                    placeholder="last Name">

                <button type="submit" class="btn btn-primary mb-2">Add Student</button>
            </form>
        </div> -->


        <!-- <div id="myModal" class="modal container" data-studentUpdateId="">
            <div class="modal-content">
                <span class="close">&times;</span>

                <h2 class="row">Update student</h2>
                <div class="row">
                    <form class="form">
                        <label class="sr-only" for="firstName">firstName</label>
                        <input type="text" class="form-control mb-2 mr-sm-2" name="firstName" id="firstName"
                            placeholder="first Name">

                        <label class="sr-only" for="lastName">lastName</label>
                        <input type="text" class="form-control mb-2 mr-sm-2" name="lastName" id="lastName"
                            placeholder="last Name">

                        <button id="okButton" type="submit" class="btn btn-success">Update Student</button>
                    </form>
                </div>
            </div>
        </div> -->




        <table class="table">

            <thead class="thead-dark">
                <td>course</td>
                <td>description</td>
                <td>options</td>
            </thead>

            <tbody id="studentCourses">

            </tbody>
        </table>



        <div class="row">
            <h4>Add courses</h4>
        </div>

        <table class="table">

            <thead class="thead-dark">
                <td>course</td>
                <td>description</td>
                <td>options</td>
            </thead>

            <tbody id="additionalCourses">

            </tbody>
        </table>






    </div>


    <script>
        const studentId = localStorage.getItem('rowId');

        // function studentData(data){
        //     // console.log(data);
        //     let stdData = data;
        //     return stdData;
        // } ;

        const studentDataUrl = 'http://localhost:8080/api/student/' + studentId;
        fetch(studentDataUrl)
            .then(res => {
                return res.json();
            })
            .then(data => {
                console.log(data);

                document.getElementsByTagName('h1')[0].innerHTML = data.firstName;


                data.coursesDto.forEach(course => {
                    const markup = "<tr> <td> "
                        + course.name +
                        " </td> <td>"
                        + course.description +
                        " </td> <td>"
                        + "<button data-id=" + course.id + " class=\"btn btn-danger deleteCourse\">Delete</button>"

                    " </td> </tr>";
                    document.getElementById('studentCourses').insertAdjacentHTML('beforeend', markup);

                });

                const deleteCourseButttons = document.querySelectorAll(".deleteCourse");
                console.log(deleteCourseButttons);

                deleteCourseButttons.forEach((button) => {
                    button.addEventListener('click', event => {
                        event.preventDefault();
                        // console.log(button.id);
                        const courseId = button.dataset.id;
                        // console.log(courseId);
                        const data = {
                            'id': courseId
                        }
                        // console.log(data);

                        if (confirm("Delete course?")) {
                            const deleteUrl = 'http://localhost:8080/api/student/deleteCourseFromStudent/' + studentId;
                            fetch(deleteUrl, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(data)

                            })
                                .then(res => {
                                    if (res.status = 200) {
                                        window.location.reload();
                                    } else {
                                        alert("cannot delete!");
                                    }
                                })
                                // .then(window.location.reload())
                                .catch(error => console.log(error))
                        }

                    })
                })


            });

        const coursesUrl = 'http://localhost:8080/api/course/all';
        fetch(coursesUrl)
            .then(res => {
                return res.json();
            })
            .then(data => {
                console.log(data);


                data.forEach(course => {
                    const markup = "<tr> <td> "
                        + course.name +
                        " </td> <td>"
                        + course.description +
                        " </td> <td>"
                        + "<button data-id=" + course.id + " class=\"btn btn-success AddCourse\">Add</button>"

                    " </td> </tr>";
                    document.getElementById('additionalCourses').insertAdjacentHTML('beforeend', markup);

                });


                const addCourseButtons = document.querySelectorAll(".AddCourse");
                addCourseButtons.forEach((button) => {
                    button.addEventListener('click', event => {
                        event.preventDefault();
                        // console.log(button.dataset.id);
                        const courseId = button.dataset.id;
                        const data = {
                            'id': courseId
                        }
                        if (confirm("Add Course?")) {
                            const addUrl = 'http://localhost:8080/api/student/addCourseToStudent/' + studentId;
                            fetch(addUrl, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(data)

                            }).then(res => {
                                if (res.status = 200) {
                                    window.location.reload();
                                } else {
                                    alert("cannot add!");
                                }
                            }).catch(error => {
                                
                                console.log(error);
                                // alert("cannot add!");
                            });
                        }


                    })
                })
                // console.log(addCourseButtons);
            });

        // console.log(studentData());
        // studentData();


    </script>




    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>

</html>